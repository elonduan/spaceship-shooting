<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ball Shooter ‚Äî Smooth Turning & Banking</title>
  <style>
    html,body{height:100%;margin:0;background:#000;color:#ddd;font-family:system-ui,-apple-system,Segoe UI,Roboto;overflow:hidden}
    #overlay{position:fixed;left:12px;top:12px;z-index:10;max-width:360px}
    .panel{background:rgba(0,0,0,0.45);padding:12px;border-radius:8px;backdrop-filter:blur(4px)}
    #win,#lose{display:none;padding:18px;margin-top:12px;border-radius:8px;font-weight:700}
    #win{background:linear-gradient(90deg,#0f0,#005500);color:#001}
    #lose{background:linear-gradient(90deg,#f00,#550000);color:#fff}
    #canvas-container{width:100%;height:100vh;display:block}
    input[type=range]{width:100%}
    label{font-size:13px;display:block;margin-top:10px}
    #crosshair{position:fixed;left:50%;top:50%;width:20px;height:20px;margin-left:-10px;margin-top:-10px;z-index:5;pointer-events:none}
    #crosshair:before,#crosshair:after{content:"";position:absolute;background:#fff}
    #crosshair:before{left:9px;top:0;width:2px;height:20px}
    #crosshair:after{left:0;top:9px;width:20px;height:2px}
    #joystick { position:fixed; bottom:80px; left:80px; width:120px; height:120px; background:rgba(255,255,255,0.1); border-radius:50%; touch-action:none; z-index:20;}
    #stick { position:absolute; left:50%; top:50%; width:50px; height:50px; margin-left:-25px; margin-top:-25px; background:rgba(255,255,255,0.3); border-radius:50%;}
    #buttons { position:fixed; bottom:80px; right:80px; display:flex; flex-direction:column; gap:12px; z-index:20;}
    #buttons button { width:70px; height:70px; border-radius:50%; border:none; background:rgba(255,255,255,0.2); color:#fff; font-size:18px;}
    #hud { 
      position:fixed; 
      top:10px; 
      left:0; 
      right:0; 
      width: 100%; 
      box-sizing: border-box;
      display:flex; 
      justify-content:space-between; 
      padding:0 20px; 
      z-index:15; 
    }
    .barContainer {
      height: 24px;
      background: rgba(255,255,255,0.2);
      border: 1px solid #888;
      border-radius: 12px;
      overflow: hidden;
      display: flex;
    }
    #playerContainer { width: 360px; }
    #enemyContainer { width: 180px; }
    #playerBar, #enemyBar {
      display:flex;
      height:100%;
      width:100%;
    }
    .hpSegment { height:100%; }
    .hpSegment.red { background: linear-gradient(90deg, #a00, #f00); flex:1; }
    .hpSegment.white { background: #fff; flex:1; }
    .hpSegment.green { background: linear-gradient(90deg, #0f0, #070); flex:1; }
    #enemyBar { background:linear-gradient(90deg,#f00,#700); }
    #arrowIndicator {
      position: fixed;
      width: 0;
      height: 0;
      border-left: 12px solid transparent;
      border-right: 12px solid transparent;
      border-bottom: 20px solid yellow;
      z-index: 50;
      transform-origin: center;
      pointer-events: none;
      display: none;
    }
  </style>
</head>
<body>
  <div id="overlay">
    <div class="panel">
      <div><strong>Ball Shooter Competition ‚Äî Smooth Turning-n</strong></div>
      <ul style="margin:8px 0 0 18px;font-size:13px">
        <li>Arrow keys / Joystick: pitch & yaw</li>
        <li>A / D buttons: roll</li>
        <li>Shoot button / Space: fire</li>
        <li>M: launch missile</li>
        <li>R: reset</li>
      </ul>
      <label for="sensitivity">Rotation sensitivity</label>
      <input id="sensitivity" type="range" min="0.005" max="3" step="0.002" value="0.015">
      <button id="resetBtn">Reset</button>
      <div id="win">You destroyed the spaceship ‚Äî you win! üéâ</div>
      <div id="lose">The spaceship destroyed you! ‚ùå</div>
    </div>
  </div>
  <div id="hud">
    <div class="barContainer" id="playerContainer">
      <div id="playerBar">
        <div class="hpSegment red"></div>
        <div class="hpSegment white"></div>
        <div class="hpSegment green"></div>
      </div>
    </div>
    <div class="barContainer" id="enemyContainer">
      <div id="enemyBar"></div>
    </div>
  </div>
  <div id="crosshair"></div>
  <div id="canvas-container"></div>
  <div id="arrowIndicator"></div>
  <div id="joystick"><div id="stick"></div></div>
  <div id="buttons">
    <button id="shootBtn">Shoot</button>
    <button id="rollLeft">A</button>
    <button id="rollRight">D</button>
  </div>
  <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/build/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/gh/mrdoob/three.js@r128/examples/js/loaders/STLLoader.js"></script>
  <script>
    // === Setup ===
    const container = document.getElementById('canvas-container');
    const scene = new THREE.Scene();
    const renderer = new THREE.WebGLRenderer({antialias:true});
    renderer.setPixelRatio(window.devicePixelRatio);
    renderer.setSize(window.innerWidth, window.innerHeight);
    container.appendChild(renderer.domElement);

    const camera = new THREE.PerspectiveCamera(70, window.innerWidth/window.innerHeight, 0.1, 5000);
    camera.position.set(0,0,0);

    // Lights
    scene.add(new THREE.AmbientLight(0x666666));
    const dirLight = new THREE.DirectionalLight(0xffffff, 1);
    dirLight.position.set(5,5,5);
    scene.add(dirLight);

    // Stars
    const starGeo = new THREE.BufferGeometry();
    const starCount = 2000;
    const positions = [];
    for (let i=0;i<starCount;i++) {
      positions.push((Math.random()-0.5)*4000, (Math.random()-0.5)*4000, (Math.random()-0.5)*4000);
    }
    starGeo.setAttribute('position', new THREE.Float32BufferAttribute(positions,3));
    const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color:0x8888ff,size:2}));
    scene.add(stars);

    // Ship (load STL)
    const loader = new THREE.STLLoader();
    let ship;
    loader.load('spaceship.stl', geometry=>{
      const material = new THREE.MeshPhongMaterial({color:0xffffff});
      ship = new THREE.Mesh(geometry, material);
      ship.scale.set(0.2,0.2,0.2);
      ship.rotation.x = -Math.PI/2;
      scene.add(ship);
    });

    // Enemy
    const enemyGeo = new THREE.SphereGeometry(20,16,16);
    const enemyMat = new THREE.MeshPhongMaterial({color:0xff0000});
    const enemy = new THREE.Mesh(enemyGeo, enemyMat);
    enemy.position.set(0,0,-600);
    scene.add(enemy);

    // Bullets
    let bullets = [];
    const bulletSpeed = 20;

    function shoot(){
      const bulletGeom = new THREE.SphereGeometry(2,8,8);
      const bulletMat = new THREE.MeshBasicMaterial({color:0xffff00});
      const bullet = new THREE.Mesh(bulletGeom, bulletMat);
      const dir = new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion).normalize();
      bullet.position.copy(camera.position);
      bullets.push({mesh:bullet,vel:dir.multiplyScalar(bulletSpeed)});
      scene.add(bullet);
    }

    // Shoot auto-fire for button
    let shootInterval = null;
    const shootBtn = document.getElementById('shootBtn');
    shootBtn.addEventListener('mousedown', () => {
      if (!shootInterval) {
        shoot();
        shootInterval = setInterval(shoot, 200);
      }
    });
    shootBtn.addEventListener('mouseup', () => {
      clearInterval(shootInterval); shootInterval = null;
    });
    shootBtn.addEventListener('mouseleave', () => {
      clearInterval(shootInterval); shootInterval = null;
    });

    // Missile
    let missiles = [];
    function launchMissile(){
      loader.load('missile.stl', geometry=>{
        const material = new THREE.MeshPhongMaterial({color:0x00ff00});
        const missile = new THREE.Mesh(geometry, material);
        missile.scale.set(0.1,0.1,0.1);
        missile.position.copy(camera.position);
        missile.quaternion.copy(camera.quaternion);
        missiles.push({mesh:missile,vel:new THREE.Vector3(0,0,-1).applyQuaternion(camera.quaternion).normalize().multiplyScalar(10)});
        scene.add(missile);
      });
    }

    // HP
    let playerHP = 20;
    let enemyHP = 20;
    const enemyBar = document.getElementById('enemyBar');
    function updateHP(){
      enemyBar.style.width = (enemyHP/20*100) + "%";
      const totalHP = 20;
      const hpPerSegment = totalHP / 3;
      const segs = document.querySelectorAll('#playerBar .hpSegment');
      let remaining = playerHP;
      segs.forEach(seg => {
        if (remaining >= hpPerSegment) {
          seg.style.flex = "1";
          remaining -= hpPerSegment;
        } else {
          seg.style.flex = (remaining / hpPerSegment).toFixed(2);
          remaining = 0;
        }
      });
    }
    updateHP();

    const winDiv = document.getElementById('win');
    const loseDiv = document.getElementById('lose');

    // Controls
    let keys = {};
    document.addEventListener('keydown',e=>{
      keys[e.key.toLowerCase()] = true;
      if(e.key===" "){ shoot(); }
      if(e.key==="m"){ launchMissile(); }
      if(e.key==="r"){ resetGame(); }
    });
    document.addEventListener('keyup',e=>{ keys[e.key.toLowerCase()] = false; });

    // Game loop
    function animate(){
      requestAnimationFrame(animate);

      // Update bullets
      bullets.forEach((b,i)=>{
        b.mesh.position.add(b.vel);
        if (b.mesh.position.distanceTo(enemy.position)<25){
          enemyHP--; updateHP();
          scene.remove(b.mesh); bullets.splice(i,1);
          if(enemyHP<=0){ winDiv.style.display='block'; }
        }
      });

      // Update missiles
      missiles.forEach((m,i)=>{
        m.mesh.position.add(m.vel);
        if (m.mesh.position.distanceTo(enemy.position)<30){
          enemyHP -= 5; updateHP();
          scene.remove(m.mesh); missiles.splice(i,1);
          if(enemyHP<=0){ winDiv.style.display='block'; }
        }
      });

      // Controls rotation
      const sensitivity = parseFloat(document.getElementById('sensitivity').value);
      if(keys['arrowup']) camera.rotateX(-sensitivity);
      if(keys['arrowdown']) camera.rotateX(sensitivity);
      if(keys['arrowleft']) camera.rotateY(sensitivity);
      if(keys['arrowright']) camera.rotateY(-sensitivity);
      if(keys['a']) camera.rotateZ(sensitivity);
      if(keys['d']) camera.rotateZ(-sensitivity);

      // Keep ship model with camera
      if(ship){ ship.position.copy(camera.position); ship.quaternion.copy(camera.quaternion); }

      renderer.render(scene,camera);
    }
    animate();

    // Reset
    function resetGame(){
      playerHP=20; enemyHP=20; updateHP();
      winDiv.style.display='none'; loseDiv.style.display='none';
      bullets.forEach(b=>scene.remove(b.mesh)); bullets=[];
      missiles.forEach(m=>scene.remove(m.mesh)); missiles=[];
      enemy.position.set(0,0,-600);
    }

    // Resize
    window.addEventListener('resize',()=>{
      camera.aspect = window.innerWidth/window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth,window.innerHeight);
    });
  </script>
</body>
</html>
